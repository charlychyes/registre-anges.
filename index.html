<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONE UNIT - PRO</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root { --primary: #0a3d62; --accent: #87CEEB; --success: #27ae60; --danger: #c0392b; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        
        /* Écran de connexion e-mail */
        #login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: var(--primary); color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:1000; }
        .login-box { background: white; padding: 30px; border-radius: 15px; width: 80%; max-width: 400px; text-align:center; color: var(--primary); }

        .container { max-width: 900px; margin: auto; background: white; min-height: 100vh; }
        .header { background: var(--primary); color: white; padding: 25px 20px; display: flex; align-items: center; border-bottom: 5px solid var(--accent); }
        .logo-img { height: 50px; width: 50px; border-radius: 50%; border: 2px solid var(--accent); margin-right: 15px; }
        
        .chart-container { width: 200px; margin: 20px auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); background: #fff; border-bottom: 1px solid #ddd; }
        .stat-item { padding: 15px; border: 0.5px solid #eee; text-align: center; }
        .stat-item b { display: block; font-size: 1.1rem; color: var(--primary); }

        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 12px; font-size: 0.75rem; color: #7f8c8d; text-transform: uppercase; }
        td { padding: 12px 8px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.85rem; }

        .btn { padding: 8px 12px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; color: white; margin: 2px; }
        .paid { background: var(--success); } .unpaid { background: var(--danger); }
        .pdf-btn { background: var(--accent); color: var(--primary); font-size: 0.7rem; }
        .del-text { color: var(--danger); font-size: 0.65rem; cursor: pointer; text-decoration: underline; border: none; background: none; font-weight: bold; }

        .admin-area { display: none; padding: 20px; background: #e1f5fe; border-top: 2px solid var(--accent); }
        input, select { padding: 12px; margin: 8px 0; width: 90%; border: 1px solid #ccc; border-radius: 8px; }
        .main-btn { background: var(--primary); color:white; border:none; padding:15px; width:95%; border-radius:8px; font-weight:bold; cursor:pointer; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2 style="margin-top:0">ONE UNIT</h2>
        <p>Veuillez entrer votre e-mail pour accéder au registre officiel.</p>
        <input type="email" id="user-email" placeholder="votre@email.com" style="width:100%; box-sizing:border-box;">
        <button onclick="saveEmail()" class="main-btn" style="margin-top:10px; width:100%">ACCÉDER</button>
    </div>
</div>

<div class="container">
    <div class="header">
        <img src="logo.png" class="logo-img" onerror="this.style.display='none'">
        <div style="flex-grow:1">
            <h1 style="margin:0; font-size: 1.4rem; letter-spacing: 1px;">ONE UNIT</h1>
            <small id="live-clock" style="color:var(--accent);"></small>
        </div>
        <button onclick="askAccess()" id="lock-btn" style="background:none; border:1px solid var(--accent); color:var(--accent); padding:6px; border-radius:5px; font-size: 0.7rem; font-weight:bold;">ADMIN</button>
    </div>

    <div class="chart-container"><canvas id="myChart"></canvas></div>

    <div class="stats-grid">
        <div class="stat-item">TOTAL USD<br><b id="tUSD">0</b></div>
        <div class="stat-item">TOTAL CDF<br><b id="tCDF">0</b></div>
        <div class="stat-item">TOTAL EUR<br><b id="tEUR">0</b></div>
        <div class="stat-item">TOTAL BIF<br><b id="tBIF">0</b></div>
    </div>

    <table>
        <thead><tr><th>MEMBRE / DATE</th><th>MONTANT</th><th>ACTIONS</th></tr></thead>
        <tbody id="list"></tbody>
    </table>

    <div id="admin" class="admin-area">
        <h3 style="margin-top:0; color:var(--primary);">NOUVEL ENREGISTREMENT</h3>
        <input type="text" id="name" placeholder="Nom du membre">
        <input type="number" id="amt" placeholder="Montant">
        <select id="cur">
            <option value="USD">Dollar (USD)</option>
            <option value="CDF">Franc Congolais (CDF)</option>
            <option value="EUR">Euro (EUR)</option>
            <option value="BIF">Franc Burundais (BIF)</option>
        </select>
        <button onclick="add()" class="main-btn">VALIDER</button>
    </div>
</div>

<script>
    // Configuration Firebase (La même que précédemment)
    const firebaseConfig = {
        apiKey: "AIzaSyB78cC9gnYCgPjd9ikZjboHqWq86-j-7YI",
        authDomain: "oneunit-dfa62.firebaseapp.com",
        databaseURL: "https://oneunit-dfa62-default-rtdb.firebaseio.com",
        projectId: "oneunit-dfa62",
        storageBucket: "oneunit-dfa62.firebasestorage.app",
        messagingSenderId: "837193571803",
        appId: "1:837193571803:web:b921421a5765c363943340"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const membersRef = db.ref('members');
    let isAdmin = false;
    let myChart;

    // Gestion de l'e-mail au démarrage
    if(localStorage.getItem('oneUnitEmail')) {
        document.getElementById('login-overlay').style.display = 'none';
    }

    function saveEmail() {
        const email = document.getElementById('user-email').value;
        if(email.includes('@')) {
            localStorage.setItem('oneUnitEmail', email);
            document.getElementById('login-overlay').style.display = 'none';
        } else {
            alert("Veuillez entrer une adresse e-mail valide.");
        }
    }

    function updateClock() {
        const now = new Date();
        document.getElementById('live-clock').innerText = now.toLocaleString('fr-FR');
    }
    setInterval(updateClock, 1000);

    function askAccess() {
        if(prompt("Code d'accès Admin :") === "05102005") {
            isAdmin = true;
            document.getElementById('admin').style.display = 'block';
            document.getElementById('lock-btn').innerText = "MODE ADMIN";
            document.getElementById('lock-btn').style.background = "#27ae60";
            document.getElementById('lock-btn').style.color = "white";
            renderList();
        }
    }

    function add() {
        const n = document.getElementById('name').value;
        const a = parseFloat(document.getElementById('amt').value);
        const d = new Date().toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' });
        if(n && a) {
            membersRef.push({ 
                name: n, 
                amount: a, 
                currency: document.getElementById('cur').value, 
                paid: false, 
                date: d,
                recordedBy: localStorage.getItem('oneUnitEmail') 
            });
            document.getElementById('name').value = ""; document.getElementById('amt').value = "";
        }
    }

    function removeMember(key) {
        if(confirm("Supprimer ce membre définitivement ?")) {
            membersRef.child(key).remove();
        }
    }

    function toggle(key, status) {
        if(isAdmin) membersRef.child(key).update({ paid: !status });
    }

    function generatePDF(name, amount, curr, date) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Design Bleu Ciel
        doc.setDrawColor(135, 206, 235); 
        doc.setLineWidth(2);
        doc.rect(10, 10, 190, 100);

        doc.setFont("helvetica", "bold");
        doc.setFontSize(22);
        doc.setTextColor(10, 61, 98); // Bleu marine
        doc.text("ONE UNIT", 105, 30, { align: "center" });
        
        doc.setFontSize(10);
        doc.setTextColor(135, 206, 235); // Bleu ciel
        doc.text("REÇU OFFICIEL DE TRANSACTION", 105, 38, { align: "center" });

        doc.setFont("helvetica", "normal");
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        doc.text(`Membre : ${name.toUpperCase()}`, 20, 60);
        doc.text(`Montant versé : ${amount} ${curr}`, 20, 70);
        doc.text(`Date : ${date || 'Non spécifiée'}`, 20, 80);
        
        doc.setFont("helvetica", "bold");
        doc.setTextColor(39, 174, 96);
        doc.text("STATUT : PAIEMENT CONFIRMÉ", 105, 95, { align: "center" });

        doc.save(`OneUnit_${name}.pdf`);
    }

    let currentData = {};
    membersRef.on('value', (snap) => {
        currentData = snap.val() || {};
        renderList();
    });

    function renderList() {
        const list = document.getElementById('list');
        list.innerHTML = "";
        let t = {USD:0, CDF:0, EUR:0, BIF:0}, pCount=0, uCount=0;

        Object.keys(currentData).forEach(key => {
            const m = currentData[key];
            if(m.paid) { t[m.currency] += m.amount; pCount++; } else { uCount++; }
            list.innerHTML += `<tr>
                <td style="text-align:left">
                    ${isAdmin ? `<button onclick="removeMember('${key}')" class="del-text">DELETE</button>` : ''}
                    <b>${m.name.toUpperCase()}</b><br><small style="color:#888">${m.date || 'Archives'}</small>
                </td>
                <td><b>${m.amount}</b> ${m.currency}</td>
                <td>
                    <button onclick="toggle('${key}', ${m.paid})" class="btn ${m.paid ? 'paid':'unpaid'}">${m.paid ? 'PAYÉ':'À PAYER'}</button>
                    ${m.paid ? `<button onclick="generatePDF('${m.name}', ${m.amount}, '${m.currency}', '${m.date}')" class="btn pdf-btn">PDF</button>` : ''}
                </td>
            </tr>`;
        });

        ['USD','CDF','EUR','BIF'].forEach(c => document.getElementById('t'+c).innerText = t[c] + (c === 'USD' ? ' $' : c === 'EUR' ? ' €' : ''));
        updateChart(pCount, uCount);
    }

    function updateChart(p, u) {
        const ctx = document.getElementById('myChart').getContext('2d');
        if(myChart) myChart.destroy();
        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Payés', 'À Payer'],
                datasets: [{ data: [p, u], backgroundColor: ['#27ae60', '#c0392b'], borderWidth: 0 }]
            },
            options: { plugins: { legend: { position: 'bottom' } }, cutout: '75%' }
        });
    }
</script>
</body>
</html>


    
